<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Online Monitoring Duren Medan</title>
    <style>
      #map {
        height: 100%; //100% tinggi
      }
      html, body {
        height: 100%; 
        margin: 0;
        padding: 0; //100% tinggi, tanpa margin, tanpa geser padding
      }
      #floating-panel {
        background-color: #fff;
        border: 1px solid #999;
        right: 0%;
        padding: 0px;
        position: absolute;
        top: 5%;
        z-index: 1;
      }
      #show-panel {
        background-color: #fff;
        border: 1px solid #999;
        right: 0%;
        padding: 0px;
        position: absolute;
        top: 0%;
        z-index: 1;
		visibility: hidden;
      }
      #hide-panel {
        background-color: #fff;
        border: 1px solid #999;
        right: 0%;
        padding: 0px;
        position: absolute;
        top: 0%;
        z-index: 1;
      }
	    table {border-collapse:collapse; width:10px;}
		table td {border:solid 1px #fab; width:10px; word-wrap:break-word;}
    </style>
  </head>

  <body onload="startTime()">
	<div id="hide-panel">
	<button id="tombol" onclick="toggleFloatingPanel()">Sembunyikan Panel Kendali</button></br>
	</div>
	<div id="show-panel">
	<button id="tombol" onclick="toggleFloatingPanel()">Munculkan Panel Kendali</button></br>
	</div>
    <div id="floating-panel"> 
	  <b>Panel Kendali</b></br>
	  	<button onclick="initMap()">Tampilan Awal</button></br>
	  	Pilih Lokasi 
		<select name="pilihlokasi" onChange="suhugas.value=myFunction(this.value)","tekanan.value=this.value">
			<option value="smarun">SM Arun</option>
			<option value="lbcv1">LBCV 1</option>
			<option value="lbcv2">LBCV 2</option>
			<option value="lbcv3">LBCV 3</option>
			<option value="lbcv4">LBCV 4</option>
			<option value="lbcv5">LBCV 5</option>
			<option value="lbcv6">LBCV 6</option>
			<option value="lbcv7">LBCV 7</option>
			<option value="skgrpa">SKG Rantau Panjang</option>
			<option value="lbcv8">LBCV 8</option>
			<option value="lbcv9">LBCV 9</option>
			<option value="lbcv10">LBCV 10</option>
			<option value="lbcv11">LBCV 11</option>
			<option value="lbcv12">LBCV 12</option>
			<option value="lbcv13">LBCV 13</option>
			<option value="lbcv14">LBCV 14</option>
			<option value="lbcv15">LBCV 15</option>
			<option value="skgpbr">SKG Pangkalan Brandan</option>
			<option value="lbcv16">LBCV 16</option>
			<option value="lbcv17">LBCV 17</option>
			<option value="lbcv18">LBCV 18</option>
			<option value="lbcv19">LBCV 19</option>
			<option value="smblw">SM Belawan</option>
			<option value="lainnya">Manual Input Koordinat</option>
			<option value="lainnya">Manual Pencarian</option>
		</select></br>
	  <div id="waktu"></div></br>
	  <b><font size="2">Posisi Kejadian Kebakaran</font></b></br>
	  <font size="2"><div id="posisi"></div></font>
	  <iframe name="openweather" src="http://api.openweathermap.org/data/2.5/weather?lat=4.017443&lon=98.275883&appid=e68dd68fe7a5d895fe5668c7a7939a45&units=metric&mode=html" width="160"></iframe>
	  </br>
	  <b>Data Penyaluran</b></br>
	  Tekanan : <input type="text" id="tekanan" value="354" size="1"> psig</br>
	  Suhu Gas : <input type="text" id="suhugas" value="80" size="1"> Â°F</br>
	  Flowrate : <input type="text" id="flowrate" value="150" size="1"> MMSCFD</br></br>
	  <button onclick="simulasi()">Simulasikan</button></br>
	   Zona Bahaya: </br>
		<font size="2"><table style="width:100%">
		<tr>
			<th>Zona</th>
			<th>Merah</th>
			<th>Oranye</th>
			<th>Kuning</th>
		</tr>
		<tr>
			<td>Radius (meter)</td>
			<td>152</td>
			<td>216</td>
			<td>336</td>
		</tr>
		<tr>
			<td>Daya ledak (kW/m2)</td>
			<td>10</td>
			<td>5</td>
			<td>2</td>
		</tr>
				<tr width="1">
			<td>Dampak</td>
			<td>Berpotensi korban jiwa dalam 60 detik</td>
			<td>Luka bakar parah dalam 60 detik</td>
			<td>Luka bakar dalam 60 detik</td>
		</tr>
		</table></font>
    </div>

    <div id="map"></div>
    <script>
		function myFunction(opsi) {
		var text;
		switch(opsi) {
			case "smarun":
			text = "Excellent choice. Martini is good for your soul.";
			break;
			case "Daiquiri":
			text = "Daiquiri is my favorite too!";
			break;
			case "Cosmopolitan":
			text = "Really? Are you sure the Cosmopolitan is your favorite?";
			break;
			default:
			text = "I have never heard of that one..";
		}
		suhugas.value = text;
		}
	//tarik data openweather API
    var zonamerah, zonaoranye, zonakuning;
	//fungsiwaktu
       function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 10,
          center: {lat: 4.017443, lng: 98.275883}, //lokasi awal
          mapTypeId: 'hybrid',  
		  mapTypeControl: true,
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
            mapTypeIds: ['roadmap', 'terrain', 'satellite', 'hybrid']}
        });
	//lingkaran potensi dampak
		var lingkaranmerah = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF0000',
            fillOpacity: 0.8,
            map: map, 
            center: {lat: 4.017443, lng: 98.275883},
            radius: 0
          });
		var lingkaranoranye = new google.maps.Circle({
            strokeColor: '#FF9900',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FF9900',
            fillOpacity: 0.4,
            map: map,
            center: {lat: 4.017443, lng: 98.275883},
            radius: 0
          });
		var lingkarankuning = new google.maps.Circle({
            strokeColor: '#FFFF00',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#FFFF00',
            fillOpacity: 0.2,
            map: map,
            center: {lat: 4.017443, lng: 98.275883},
            radius: 0
          });
		  zonamerah = lingkaranmerah;
		  zonaoranye = lingkaranoranye;
		  zonakuning = lingkarankuning;

		var lbcvicon = 'https://raw.githubusercontent.com/durenmedan/durenmedan/master/lbcvicon.png';
		var smicon = 'https://raw.githubusercontent.com/durenmedan/durenmedan/master/smicon.png';
		var skgicon = 'https://raw.githubusercontent.com/durenmedan/durenmedan/master/skgicon.png';
        var icons = {
          sm: {
            name: 'StasiunMetering',
            icon: smicon
          },
          skg: {
            name: 'StasiunKompresorGas',
            icon: skgicon
          },
          lbcv: {
            name: 'LBCV',
            icon: lbcvicon
          }
		}
		var features = [
          {
            position: new google.maps.LatLng(5.221634, 97.077584), //SM Arun
            type: 'sm',
			title: 'SM Arun'
          }, {
            position: new google.maps.LatLng(5.09859, 97.138503), //LBCV 1
			type: 'lbcv',
			title: 'LBCV 1'
          }, {
		    position: new google.maps.LatLng(5.0511286, 97.2553603), //LBCV 2
			type: 'lbcv',
			title: 'LBCV 2'
          }, {
			position: new google.maps.LatLng(4.9491693, 97.3376748), //LBCV 3
			type: 'lbcv',
			title: 'LBCV 3'
          }, {
            position: new google.maps.LatLng(4.8682137, 97.4479687), //LBCV 4
			type: 'lbcv',
			title: 'LBCV 4'
          }, {
            position: new google.maps.LatLng(4.899277, 97.554188), //LBCV 5
			type: 'lbcv',
			title: 'LBCV 5'
          }, {
            position: new google.maps.LatLng(4.8323902, 97.6078731), //LBCV 6
			type: 'lbcv',
			title: 'LBCV 6'
          }, {
            position: new google.maps.LatLng(4.835706, 97.708989), //LBCV 7
			type: 'lbcv',
			title: 'LBCV 7'
          }, {	
            position: new google.maps.LatLng(4.763970, 97.795643), //SKG RPA
			type: 'skg',
			title: 'SKG Rantau Panjang'
          }, {		  
            position: new google.maps.LatLng(4.665926, 97.837022), //LBCV 8
            type: 'lbcv',
			title: 'LBCV 8'
          }, {
            position: new google.maps.LatLng(4.578443, 97.889069), //LBCV 9
            type: 'lbcv',
			title: 'LBCV 9'
          }, {
            position: new google.maps.LatLng(4.4583309, 97.9258811), //LBCV 10
            type: 'lbcv',
			title: 'LBCV 10'
          }, {
            position: new google.maps.LatLng(4.37855, 98.024541), //LBCV 11
            type: 'lbcv',
			title: 'LBCV 11'
          }, {
            position: new google.maps.LatLng(4.29723, 98.08454), //LBCV 12
            type: 'lbcv',
			title: 'LBCV 12'
          }, {
            position: new google.maps.LatLng(4.181811, 98.043201), //LBCV 13
            type: 'lbcv',
			title: 'LBCV 13'
          }, {
            position: new google.maps.LatLng(4.06212, 98.1121), //LBCV 14
            type: 'lbcv',
			title: 'LBCV 14'
          }, {
            position: new google.maps.LatLng(4.03305, 98.2082), //LBCV 15
            type: 'lbcv',
			title: 'LBCV 15'
          }, {
            position: new google.maps.LatLng(4.017443, 98.275883), //SKG PBR 
            type: 'skg',
			title: 'SKG Pangkalan Brandan'
		  }, {		  
            position: new google.maps.LatLng(3.773384, 98.671206), //SM Belawan
            type: 'sm',
			title: 'SM Belawan'
          } 
        ];
		//membuat penanda
        features.forEach(function(feature) {
          var markercoba = new google.maps.Marker({
            position: feature.position,
            icon: icons[feature.type].icon,
            map: map,
			title: feature.title
          });
        });

        marker1 = new google.maps.Marker({
          map: map,
          draggable: true,
          animation: google.maps.Animation.DROP,
          position: {lat: 4.017443 , lng: 98.275883}
		 // label: labels
        });
        marker1.addListener('click', toggleBounce);

		//external KML url
		var ctaLayer = new google.maps.KmlLayer({
          url: 'https://raw.githubusercontent.com/durenmedan/durenmedan/master/ctaq.kml',
          map: map
        });
      }

		function startTime() {
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1;
			var yy = today.getFullYear();
			var h = today.getHours();
			var m = today.getMinutes();
			var s = today.getSeconds();
			dd = checkTime(dd);
			mm = checkTime(mm);
			h = checkTime(h);
			m = checkTime(m);
			s = checkTime(s);
			document.getElementById('waktu').innerHTML = "Tanggal "+dd+"-"+mm+"-"+yy+"</br>"+
			h + ":" + m + ":" + s + " WIB";
			document.getElementById('posisi').innerHTML = marker1.position;//marker1.getPosition().lat();
			var ifr = document.getElementsByName('openweather')[0];
			lat = marker1.getPosition().lat();
			lng = marker1.getPosition().lng();
			ifr.src = 'http://api.openweathermap.org/data/2.5/weather?lat='+lat+'&lon='+lng+'&appid=e68dd68fe7a5d895fe5668c7a7939a45&units=metric&mode=html';
			var t = setTimeout(startTime, 500);
		}
		function checkTime(i) {
		if (i < 10) {i = "0" + i};  // menambah digit 0 untuk satuan
		return i;
		}
      function toggleBounce() {
        if (marker1.getAnimation() !== null) {
          marker1.setAnimation(null);
        } else {
          marker1.setAnimation(google.maps.Animation.BOUNCE);
        }
      }

	  //tampilan panel kendali
	  function toggleFloatingPanel() {
        if(document.getElementById("floating-panel").style.visibility !== "hidden"){
			document.getElementById("floating-panel").style.visibility = "hidden";
			document.getElementById("hide-panel").style.visibility = "hidden";
			document.getElementById("show-panel").style.visibility = "visible";
			
		} else {
			document.getElementById("floating-panel").style.visibility = "visible";
			document.getElementById("hide-panel").style.visibility = "visible";
			document.getElementById("show-panel").style.visibility = "hidden";
		}
      }

      function changeGradient() {
        var gradient = [
          'rgba(0, 255, 255, 0)',
          'rgba(0, 255, 255, 1)',
          'rgba(0, 191, 255, 1)',
          'rgba(0, 127, 255, 1)',
          'rgba(0, 63, 255, 1)',
          'rgba(0, 0, 255, 1)',
          'rgba(0, 0, 223, 1)',
          'rgba(0, 0, 191, 1)',
          'rgba(0, 0, 159, 1)',
          'rgba(0, 0, 127, 1)',
          'rgba(63, 0, 91, 1)',
          'rgba(127, 0, 63, 1)',
          'rgba(191, 0, 31, 1)',
          'rgba(255, 0, 0, 1)'
        ]
        heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
      }

      function simulasi() {
		zonakuning.set('radius', 336);
		zonakuning.set('center', marker1.position);
		zonaoranye.set('radius', 216);
		zonaoranye.set('center', marker1.position);
		zonamerah.set('radius', 152);
		zonamerah.set('center', marker1.position);
      }

      // Heatmap data
      function getPoints() {
        return [
          new google.maps.LatLng(3.782551, 98.445368),
          new google.maps.LatLng(3.782745, 98.444586),
          new google.maps.LatLng(3.782842, 98.443688),
          new google.maps.LatLng(3.782919, 98.442815),
          new google.maps.LatLng(3.782992, 98.442112),
          new google.maps.LatLng(3.783100, 98.441461),
          new google.maps.LatLng(3.783206, 98.440829),
          new google.maps.LatLng(3.760851, 98.443118),
          new google.maps.LatLng(3.757039, 98.404346),
          new google.maps.LatLng(3.756335, 98.403719),
          new google.maps.LatLng(3.755503, 98.403406),
          new google.maps.LatLng(3.754665, 98.403242),
          new google.maps.LatLng(3.753837, 98.403172),
          new google.maps.LatLng(3.752986, 98.403112),
          new google.maps.LatLng(3.751266, 98.403355)
        ];
      }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAx74v7Xf0TNQqF2wSUB5r-oEGBfnlls1Q&libraries=visualization,places,geometry,drawing&callback=initMap">
    </script>
  </body>
</html>
